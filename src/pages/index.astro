---
import Layout from '@layouts/Layout.astro'
import SectionContainer from '@components/SectionContainer.astro'
import SocialPill from '@components/SocialPill.astro'

import MailIcon from '@icons/Mail.astro'
import GitHubIcon from '@icons/GitHub.astro'
import LinkedInIcon from '@icons/LinkedIn.astro'
import Briefcase from '@icons/Briefcase.astro'
import Code from '@icons/Code.astro'
import School from '@icons/School.astro'
import Sliders from '@icons/Sliders.astro'
import MessageCode from '@/icons/MessageCode.astro'

import Experience from '@/sections/Experience.astro'
import Projects from '@/sections/Projects.astro'
import Education from '@/sections/Education.astro'
import Skills from '@/sections/Skills.astro'
---

<Layout title="Welcome to Astro.">
	<main class="max-w-4xl mx-auto w-full h-full flex flex-col px-2 pt-4 pb-10">
		<SectionContainer id="about">
			<div class="flex gap-x-4">
				<figure class="hidden md:flex justify-center items-center object-fit flex-shrink-0 relative w-[256px] h-[256px]">
					<img src="/development.webp" class="rounded" alt="Ebert Escalante" loading="lazy" />
				</figure>
				<div class="flex flex-col flex-1">
					<div class="flex items-center">
						<a
							href="https://linkedin.com/in/ebert-escalante"
							target="_blank"
							rel="noopener"
							class="flex items-center transition md:justify-center md:hover:scale-105"
						>
							<div class="flex items-center">
								<span class="relative inline-flex overflow-hidden rounded-full p-[1px]">
									<span class="absolute inset-[-1000%] animate-[spin_2s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#51E4B8_0%,#21554E_50%,#51E4B8_100%)]"></span>
									<div class="inline-flex items-center justify-center w-full px-3 py-1 text-sm text-green-800 bg-green-100 rounded-full cursor-pointer dark:bg-gray-800 dark:text-white/80 backdrop-blur-3xl whitespace-nowrap">
										Disponible para trabajar
									</div>
								</span>
							</div>
							<!-- <Badge>Disponible para trabajar</Badge> -->
						</a>
						<div class="flex flex-1 justify-end gap-x-2">
							<SocialPill href="mailto:ebertescalant@gmail.com">
								<MailIcon class="size-5" />
							</SocialPill>
							<SocialPill href="https://github.com/ebert-escalant">
								<GitHubIcon class="size-5" />
							</SocialPill>
							<SocialPill href="https://linkedin.com/in/ebert-escalante">
								<LinkedInIcon class="size-5" />
							</SocialPill>
						</div>
					</div>
					<div class="flex-1 mt-4">
						<h1 class="text-3xl font-bold tracking-tight text-gray-800 dark:text-white">
							Hola, soy Ebert Escalante
						</h1>
						<p class="mt-3 text-md text-gray-800 dark:[&>strong]:text-teal-400 [&>strong]:text-teal-500 [&>strong]:font-semibold dark:text-gray-300">
							<strong>Bachiller en ingeniería informática y sistemas</strong>, <strong>desarrollador fullstack junior con más de un año de experiencia</strong>, especializado en el desarrollo de aplicaciones web y móviles utilizando tecnologías modernas y actualmente resido en Abancay, Apurímac, Perú.
						</p>

					</div>
				</div>
			</div>
		</SectionContainer>
		<SectionContainer id="experience" title="Experiencia laboral">
			<Briefcase class="size-7" slot="icon" />
			<div class="ml-3">
				<Experience />
			</div>
		</SectionContainer>
		<SectionContainer id="projects" title="Proyectos">
			<Code class="size-7" slot="icon" />
			<Projects />
		</SectionContainer>
		<SectionContainer id="education" title="Educación">
			<School class="size-7" slot="icon" />
			<div class="ml-3">
				<Education />
			</div>
		</SectionContainer>
		<SectionContainer id="skills" title="Habilidades">
			<Sliders class="size-7" slot="icon" />
			<Skills	/>
		</SectionContainer>
		<SectionContainer id="contact" title="Contacto">
			<MessageCode class="size-7" slot="icon" />
			<form class="mt-4" id="frmContact">
				<p class="font-light text-gray-800 dark:text-white">
					¿Tienes alguna pregunta o simplemente quieres saludar? ¡No dudes en ponerte en contacto conmigo!
				</p>
				<div id="success-alert" class="flex items-center p-4 my-4 text-green-800 border-t-4 border-green-300 bg-green-50 dark:text-green-400 dark:bg-gray-800 dark:border-green-800" style="display: none;">
					<svg class="flex-shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
						<path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
					</svg>
					<div class="ms-3 text-sm font-medium">
						<p>Muchas gracias por tu mensaje. Me pondré en contacto contigo lo más pronto posible.</p>
					</div>
					<button type="button" class="ms-auto -mx-1.5 -my-1.5 bg-green-50 text-green-500 rounded-lg focus:ring-2 focus:ring-green-400 p-1.5 hover:bg-green-200 inline-flex items-center justify-center h-8 w-8 dark:bg-gray-800 dark:text-green-400 dark:hover:bg-gray-700"  id="close-alert">
						<span class="sr-only">Dismiss</span>
						<svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
						<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
						</svg>
					</button>
				</div>
				<div class="mt-4">
					<label for="name" class="block text-sm font-medium text-gray-700 dark:text-white">
						Nombre
					</label>
					<input
						type="text"
						id="name"
						name="name"
						class="mt-2 block w-full px-3 py-2 border bg-gray-50 dark:bg-transparent border-gray-300 dark:border-neutral-700 rounded shadow-sm focus:ring-0 focus:outline-none sm:text-sm"
					/>
				</div>
				<div class="mt-4">
					<label for="email" class="block text-sm font-medium text-gray-700 dark:text-white">
						Correo electrónico
					</label>
					<input
						type="email"
						id="email"
						name="email"
						class="mt-2 block w-full px-3 py-2 border bg-gray-50 dark:bg-transparent border-gray-300 dark:border-neutral-700 rounded shadow-sm focus:ring-0 focus:outline-none sm:text-sm"
					/>
				</div>
				<div class="mt-4">
					<label for="message" class="block text-sm font-medium text-gray-700 dark:text-white">
						Mensaje
					</label>
					<textarea
						id="message"
						name="message"
						rows="4"
						class="mt-2 block w-full px-3 py-2 border bg-gray-50 dark:bg-transparent border-gray-300 dark:border-neutral-700 rounded shadow-sm focus:ring-0 focus:outline-none sm:text-sm"
					></textarea>
				</div>
				<div class="mt-4">
					<button
						type="submit"
						class="inline-flex items-center px-4 py-1.5 border border-transparent text-base font-medium rounded shadow-sm text-white bg-teal-500 hover:bg-teal-600 focus:outline-none focus:ring-0"
					>
						Enviar mensaje
					</button>
				</div>
			</form>
		</SectionContainer>
	</main>
</Layout>
<script>
	const successAlert = document.getElementById('success-alert') as HTMLDivElement
	const close = document.getElementById('close-alert') as HTMLButtonElement
	const form = document.getElementById('frmContact') as HTMLFormElement

	if (close) {
		close.addEventListener('click', () => {
			successAlert.style.display = 'none'
		})
	}

	if (form) {
		form.addEventListener('submit', async (event) => {
			event.preventDefault()

			const name = document.getElementById('name') as HTMLInputElement
			const email = document.getElementById('email') as HTMLInputElement
			const message = document.getElementById('message') as HTMLTextAreaElement

			if (!name.value || !email.value || !message.value) {
				console.log('All fields are required')
				alert('Todos los campos son requeridos')
				return
			}

			const response = await fetch('http://localhost:8000/api/mail-contact', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					name: name.value,
					email: email.value,
					message: message.value,
				})
			})

			const data = await response.json()

			if (data?.type === 'success') {
				form.reset()

				successAlert.style.display = 'flex'
			}
		})
	}
</script>